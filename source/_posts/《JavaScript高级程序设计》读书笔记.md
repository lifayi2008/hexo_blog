---
title: 《JavaScript高级程序设计》读书笔记
date: 2016-10-18 16:22:08
tags: JavaScript
categories: JavaScript
---
#### JavaScript简介

一个完整的JavaScript实现包含下面三个组成部分：

    *   核心（ECMAScript）
    *   文档对象模型（DOM）
    *   浏览器对象模型（BOM）
<!-- more -->
`ECMAScript`与特定的浏览器没有关系，甚至没有包含输入和输出，它只是定义了语言的基础部分：`语法` `类型` `语句` `关键字` `保留字` `操作符` `对象`

`JavaScript`实现了`ECMAScript`；其他的比如：`Adobe ActionScript`也实现了`ECMAScript`

`文档对象模型（DOM）`是浏览器提供的用于操作`XML/HTML`文档的接口，通过这个接口用户在无需重新加载页面的情况下就可以改变浏览器显示的页面的元素

`浏览器对象模型（BOM）`是浏览器提供的用于操作浏览器本身行为和表现的接口

#### 在HTML中使用JavaScript

`<script>`元素中的常用属性：`src` `type`  `async`  `defer`

`src`表示包含要执行的代码的外部文件（如果直接在页面中写js脚本则不需要指定这个属性值）

`type`表示编写代码使用的脚本语言的内容类型（MIME类型），这个值通常设置为`text/javascript`

`async`表示文档和js文件的加载是异步的，只对外部脚本有效；两个异步的脚本不能有依赖关系，因为这两个脚本的执行顺序不确定；异步脚本一定会在页面`load`事件前执行，但可能会在`DOMContentLoaded`事件触发之前或者之后执行

`defer`表示脚本可以延迟到文档加载完毕之后再执行，只对为外部脚本有效

    <script type="text/javascript" src="example.js"></script>
    注意后面的</script>是必须的
    
可以使用`<noscript>`元素来让不支持或者禁用JavaScript的浏览器显示一条信息

#### 基本概念

`ECMAScript`中的一切都区分大小写（变量、函数名、操作符）

`ECMAScript`中个的标识符规则类似于`JAVA`：第一个字符必须是`字母` `_` `$`，其他的字符可以是`字母` `数字` `_` `$`；标识符中也可以包含扩展的`ASCII`和`Unicode`中的**字母字符**；按照惯例`ECMAScript`标识符也采用驼峰式的命名方法

`ECMAScript`中的注释规则同`JAVA`：`//` `/* */`

`ECMAScript5`引入了严格模式，这中模式在某些情况下会报错而不是忽略错误的代码，可以在整个脚本或者函数的第一行加上`use strict`来启用脚本或者函数的严格模式

`ECMAScript5`的语句以一个分号结尾，不适用分号在大多数情况下也是允许的，但是你应该总是使用分号；条件控制语句应该总是使用`{}`将后面的语句括起来，即使只有一条语句

`ECMAScript5`的变量是松散类型的，变量使用`var`关键字加变量名来定义；定义时未直接初始化的变量会被赋一个特殊的`undefined`**字面值**

> 使用`var`关键字定义的变量为当前作用域中的局部变量，在离开当前作用于后即被销毁，如果要创建一个全局的变量可以不加`var`关键字

> ECMAScrip不推荐在局部作用域中定义全局变量

可以使用一条语句定义多个变量，中间使用`,`分隔

`ECMAScript`中有五种简单的数据类型：`Undefined` `Null` `Boolean` `Number` `String`；还有一种复杂数据类型：`Object`，`Object`本质上是由一组无序键值对组成。`ECMAScript`不支持自定义类型，所有类型都是由以上几种类型组成

可以使用`typeof`来检查一种变量的类型，它可以返回以下字符串之一：`"undefined"` `"boolean"` `"string"` `"number"` `"object"`(如果是一个对象或者`null`) `"function"`

> `typeof`是一个操作数，因此可以使用`typeof(var)`，也可以使用`typeof var`的形式

##### `undefined`和`Null`类型

`undefined`类型只有一个值`undefined`，通常用来表示未定义的变量。在对变量进行操作之前，变量必须是已经声明或者定义的；对未经声明的变量只能执行一种操作：使用`typeof`取得类型--返回`"undefined"`字符串（和未定义的变量一样）

`Null`类型也只有一个值`null`；使用`typeof`对`null`字面值进行检查时返回`"Object"`字符串。如果定义一个变量将来用于保存对象，则最好将这个变量初始化为`null`，这样以来后面只要检查这个值是否等于`null`就知道它是否已经保存了对象：`if(var == null)`

##### `Boolean`类型

`Boolean`有两个值`true` `false`（注意大小写）；布尔值和数字值不同，因此`true`不一定等于1，`false`也不一定等于0；`ECMAScript`中其他类型都有和`Boolean`等价的值：

    Boolean     true            false
    String      任何非空字符串  ""（空字符串）
    Number      任何非0数值     0和NaN
    Object      任何对象        null
    Undefined                   undefined
    
> 可以使用`Boolean()`函数将其他类型转换为对应的`Boolean`类型；在`Boolean`上下文中，解释器会自动进行转换

##### `Number`类型

`ECMAScript`可以使用如下的整数数值字面量来给数值型变量赋值：`整数` `以0开始的八进制数值` `以0x开始的十六进制数值`。在进行运算时八进制和十六进制数值都转换为十进制数值进行算术运算。

> 八进制数值在严格模式下是无效的，会导致JavaScript引擎抛出错误

浮点数值就是该数值中包含一个小数点，并且小数点后面至少有一位数字。浮点数值所占的空间是整数数值的两倍，所以解释器会将一些浮点数转换为整数，比如：`1.` `10.0`；浮点数也可以使用科学记数法表示

`ECMAScript`能保存的最大和最小数值分别是：`Number.MAX_VALUE` `Number.MIN_VALUE`；如果计算结果超出这个数值范围，则结果是`Infinity`，这个值不能再参与下一次运算了

> 可以使用`isFinite()`函数来测试一个数值是否是可计算的

`NaN`字面量是一个特殊的数值，表示一个本来应该返回数值的表达式未返回数值的情况。`NaN`与任何值都不相等，并且所有对`NaN`的操作都返回`NaN`

> 可以使用`isNaN()`函数来测试一个表达式是否是`NaN`，只有在参数的结果是一个非`NaN`的数值或者能转换为数值时结果才为真

有三个函数用来把其他类型转换为数值类型：`Number()` `parseInt()` `parseFloat()`

*   `Number()`函数的转换规则请参考`《JavaScript高级程序设计》`p30
*   `parseInt()`会忽略前面的空格直到找到第一个非空字符，并检查看是否是能识别的格式（比如：`0x` `0`）或者是一个数字，否则的话就返回`NaN`（空字符串返回`NaN`），然后继续检查第二个字符，直到解析完所有的字符或者遇到一个非数字字符

> 注意：`ECMAScript 5`不再能识别八进制格式数值，所以`"070"`会被识别为十进制的70

这个函数的第二个参数可以指定解析字符串时的基数，如果指定为16，则字符串中可以不以`0x`开始。`ECMAScript`建议在任何时候都应该指定基数

*   `parseFloat()`和`parseInt`类似，一个一个解析字符串中的字符直到不能识别的字符为止；字符串中的第一个小数点会识别为有效的小数点，但是第二个则被作为无效值；十六进制格式被转换为0；如果字符串中不包含小数点则被转换为整数

##### `String`类型

`String`类型有0个或者多个`Unicode`字符组成，使用单引号或者双引号引用（两种写法完全一样）

`ECMAScript`中可以使用一下字符串字面量：`\n` `\t` `\b` `\r` `\f` `\\` `\'` `\"` `\xnn` `\unnnn`

*   `\xnn` : 使用十六进制字符`nn`表示一个`ASCII`字符
*   `\unnnn` : 使用十六进制字符`nnnn`表示一个`Unicode`字符

任何字符串的长度都可以通过其`length`属性获取；如果字符串中包含双字节的字符则`length`可能获取到的长度不准确

和`JAVA`语言相同，`ECMAScript`中的字符串也是不可变的

除`null` `undefined`类型以外其他类型都可以调用`toString()`方法转换为字符串；`Number`类型在转换为字符串时可以指定一个参数表示基数

可以使用`String()`函数将任意类型转换为字符串，规则如下：

    如果值有`toString()`方法则调用这个方法
    如果值是 null 则返回 "null"
    如果值是 undefined 则返回 "undefined"

##### `Object`类型

`ECMAScript`中的对象就是一组数据和功能的集合。对象可以通过`new`关键字后跟要创建对象的*类型名称*来创建。创建`Object`类型的实例并且为其添加属性和方法就创建了*自定义的类型*：

    var o = new Object();

> 类型名称包括各种简单类型和`Object`类型

就像`JAVA`中的`Object`类型，`ECMAScript`中的`Object`类型是所有它的实例的基础；`Object`类型中存在的属性和方法同样也存在与更具体的对象中：

*   `constructor` 保存这创建当前对象的函数
*   `hasOwnProperty(propertyName)` 用于检查给定的属性在当前对象实例（不是实例原型）中是否存在；`propertyName`必须是字符串
*   `isPropertyOf(object)` 用于检查传入对象是否是传入对象的原型
*   `propertyIsEnumerable(propertyName)` 用于检查给定的属性是否可以使用`for-in`语句来枚举；`propertyName`必须是字符串
*   `toLocaleString() toString()`返回对象的字符串表示
*   `valueOf()` 返回对象的字符串、数值或者布尔值表示

> `ECMAScript-262`不负责定义宿主对象（浏览器中的BOM和DOM对象），因此宿主对象不一定会继承`Object`对象

##### 操作符

将操作符应用于对象时，解释器通常会调用对象的`toString()`或者`valueOf()`方法返回一个可操作的值

`ECMAScript`同样支持`JAVA`中的各种操作符；但是`ECMAScript`中的操作符可以应用于任意类型；非数值类型往往要先做各种各样的转换后在进行操作（详细的规则参考`《JavaScript高级程序设计》`p37）

`ECMAScript`中的位操作规则和`JAVA`一样

`ECMAScript`中支持`!`（逻辑非操作符） `&&`（逻辑与操作符） `||`（逻辑或操作符）和`JAVA`中不同的是操作数可以是任意类型，当两边或者任意一边操作数不是布尔值时，解释器会安装一定的规则进行计算，详细参考`《JavaScript高级程序设计》`p44

`ECMAScript`中的乘性操作符（`*` `/` `%`）和加性操作符（`+` `-`）和`JAVA`中不同的是操作数可以是任意类型，解释其会根据一定的规则将其转换为数值再进行计算

`ECMAScript`中包括如下关系操作符：`>` `>=` `<` `<=`；根据操作数的类型会按如下规则比较：1）如果两边都是数值则进行数值比较，2）如果两边都是字符串则进行字符编码比较，3）如果一个操作数是数值则将另外一个操作数也转换为数值，4）如果操作数是对象则先调用对象的`valueOf()`方法，使用返回值按上面的规则进行比较，如果没有这个方法则调用`toString()`方法

`ECMAScript`中包括`==` `!=`相等性操作符，具体比较规则参考`《JavaScript高级程序设计》`p51；另外`ECMAScript`中还有一个全等操作符`===`，它只有在两边数据类型相同并且值相等的情况下才返回`true`

`ECMAScript`中还支持如下形式的三元操作符:
    
    variable = boolean_expression ? true_value : false_value
    
表示如果`boolean_expression`结果为`true`则使用`true_value`为`variable`赋值，否则使用`false_value`为`variable`赋值

`ECMAScript`中支持如下赋值操作符：`=` `+=` `-=` `*=` `/=` `%=` `<<=` `>>=` `>>>=`

`ECMAScript`中的`,`操作符有两种使用方法：1）在定义变量是可以分隔多个变量定义；2）使用`(2,0)`这中形式的表达式会返回最后一个值0，这在大多数情况下没有什么意义

##### 语句

`ECMAScript`中的语句类似与`JAVA`中的语句，但是有些地方不同：

*   `if`语句的条件表达式结果可以是任意类型，解释器会调用`boolean()`函数将这个值转换为`Boolean`类型

> 各种语句中的执行语句块应该总是使用`{}`代码块，即使只有一条语句

*   `while` `do-while`语句也和`if`一样，条件表达式的结果可以是任意类型
*   除了传统的`for`语句之外，`ECMAScript`还支持`for-in`语句用来枚举对象的属性：
```javascript
for(var property in expression) statement
```

> 同`for`循环，`var`关键字在这里不是必须的，但是你应该总是使用这个关键字，这样可以创建一个局部变量

*   和`JAVA`中一样，`ECMAScript`也支持`label`语句，并且可以在`break` `continue`语句后面加上之前定义的关键字来直接跳到这个地方执行

> 同`JAVA` `label`语句最好放在循环之前，然后在多层循环中可以直接跳到这里执行

`ECMAScript`支持`with`语句，但是因为可能会降低性能，所以不推荐使用

`ECMAScript`也支持`switch-case`语句：
```javascript
switch(expression) {
    case value: statement
    break;
    case value: statement
    break;
    default: statement
}
```
和`JAVA`中不同的是`case`可以是任意类型，并且也可以是变量、表达式

> `expression`在和各个`case`比较的时候使用的是全等操作符`====`所以不会进行类型转换

##### 函数

`ECMAScript`使用关键字`function`来声明函数：
```javascript
function functionName(arg0, arg1, ....) {
    statements
}
```
`ECMAScript`中的函数不用声明返回值，但是可以在任意时候使用`return`关键字后面加上一个表达式来返回一个值；也可以在`return`关键字后面不加表达式，这样返回值是`undefined`字面量值，并且函数从这里结束

我们可以在任意情况下给函数传0个或者多个参数，这不受函数声明时指定的参数数量的限制。我们可以在函数内部使用一个对象`arguments`来获取所有的参数，这个对象的`length`属性保存了实际传递的参数的个数；`arguments`对象中的元素是可读写的

> 虽然访问函数的参数的方法是：`arguments[0]` `arguments[1]` `...`，但是`arguments`并不是一个数组

虽然可以通过`arguments`对象获取所有参数，但是函数声明时的命名参数也是有用的，我们也可以通过命名参数访问对应的实参

> 注意：命名参数和保存在`arguments`对象中的参数是同步的，但是并不是同一个对象；而且当声明了两个命名参数，我们调用函数时只传递一个的话，另外一个被赋`undefined`值

> `ECMAScript`中没有函数重载，如果定义了两个名称相同，参数不同的函数，则实际只有第二个是有效的

#### 变量、作用域和内存问题

##### 基本类型和引用类型

`ECMAScript`中变量的值可以是基本类型（基本数据类型）和引用类型（对象）；基本类型是指简单的数据段，而引用类型是指那些可能由多个值构成的对象

创建一个基本类型或者引用类型的变量的方式是相同的，但是当相应的类型赋值到这个变量之后，我们可以对这个变量名的操作就不同了。对于引用类型我们可以动态的给它添加属性和方法，也可以改变和删除其属性和方法；但是我们不能给基本类型添加属性和方法

`ECMAScript`中基本类型和引用类型的复制区别和`JAVA`一样，即：基本类型复制值，引用类型复制地址（引用）；不同的是`ECMAScript`中的`String`是基本类型，`JAVA`中的字符串是一个对象；但是他们表现是一样的

> 注意：变量的访问有按值访问和按引用访问的区别；但是复制时只按值访问（参数传递同复制）

`typeof`操作符用来确定一个变量的类型（通过返回一个表示类型的字符串）：`"string"` `"number"` `"boolean"` `"object"` `"undefined"` `"function"`

`instanceof`操作符用来确定一个对象是什么类型的对象：
```javascript
result = variable instanceof constructor
```

> 因为所有引用类型的值都是`Object`的实例，所以在检测一个引用类型和`Object`构造函数时，始终返回`true`；如果检测一个基本类型的变量，则始终返回`false`

##### 执行环境及作用域

执行环境定义了变量或者函数有权访问的其他数据，决定了他们各自的行为。每个执行环境都有一个与之相关联的变量对象，环境中定义的所有变量和函数都保存在这个对象中。代码无法访问这个对象，但解析器在处理数据时会在后台访问它

某个执行环境中所有代码执行完毕后，该环境即被销毁，保存在其中的所有变量和函数

在WEB浏览器中全局执行环境是`window`对象，因此所有全局变量和函数都是作为`window`对象的方法和属性创建的；这个全局执行环境直到所有代码执行完毕或者浏览器关闭时才会被销毁

当代码在一个环境中执行时会创建变量对象的一个作用域链。作用域链的用途是保证对执行环境有权访问的所有变量和函数的有序访问。作用域链的前端，始终都是当前执行代码所在的环境的变量对象。如果这个环境是一个函数，则将其*活动对象*作为变量对象。活动对象在一开始时只包含一个变量：`arguments`对象（这个对象在全局中是不存在的）。作用域链中的下一个变量对象来自包含（包含当前环境）环境，这样一直延续到全局环境。全局环境的变量对象始终是作用域链中的最后一个对象

标识符解析是沿着作用域链一级一级搜索标识符的过程：从前端开始，直到找到标识符为止；如果找不到通常会导致错误发生

`JavaScript`中有两种方法可以延长作用域链（在作用域链的前端临时增加一个变量对象）：1）`with`语句会将指定的对象添加到作用域链中；2）`try-catch`语句会创建一个新的变量对象，其中包含的是被抛出的错误对象的声明

`JavaScript`中*没有块级作用域* ：在代码块中（`if` `while` `for`等，不包含函数）定义的变量会被添加到当前执行环境，在代码块结束后这变量也存在；但是在其他语言，比如`C` `C++` `JAVA`中，任何代码块都是一个作用域

> `for`循环的`()`中创建的变量也被添加到当前执行环境中

#### 引用类型
